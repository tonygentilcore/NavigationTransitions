<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Navigation Transitions</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<script
		src="bower_components/platform/platform.js"></script>
		<link rel="import"
		href="bower_components/web-spec-framework/framework.html"/>
		<script src="../assets/scripts/spec-assist.js"></script>
	</head>
	<body>

		<div class="head">
			<div class="logo">
				<a href="//www.w3.org/"><img width="72" height="48" src="//www.w3.org/Icons/w3c_home" alt="W3C"></a>
			</div>

			<h1>Navigation Transitions</h1>
			<h2 id="editors-draft">W3C Editor's Draft</h2>
			<dl>
				<dt>
					This version
				</dt>
				<dd>
					<a href="https://tonygentilcore.github.io/NavigationTransitions/spec/">https://tonygentilcore.github.io/NavigationTransitions/spec/</a>
				</dd>
				<dt>
					Latest editor's draft
				</dt>
				<dd>
					<a href="https://tonygentilcore.github.io/NavigationTransitions/spec/">https://tonygentilcore.github.io/NavigationTransitions/spec/</a>
				</dd>
				<dt>
					Previous version
				</dt>
				<dd>
					none
				</dd>
				<dt>
					Revision history
				</dt>
				<dd>
					<a id="log" href="https://github.com/tonygentilcore/NavigationTransitions/commits/gh-pages">https://github.com/tonygentilcore/NavigationTransitions/commits/gh-pages</a>
				</dd>
				<dt>
					Participate
				</dt>
				<dd>
					Discuss on <a href="http://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org</a> (<a href="http://www.w3.org/2008/webapps/">Web Applications Working Group</a>)
				</dd>
				<dd>
					<a href="https://github.com/tonygentilcore/NavigationTransitions/issues">File bugs</a>
				</dd>
				<dt>
					Editors
				</dt>
				<dd class="vcard">
					<span class="fn">Tony Gentilcore</span>, <span class="org">Google</span>, &lt;<a class="email" href="mailto:tonyg@chromium.org">tonyg@chromium.org</a>&gt;
				</dd>
				<dd class="vcard">
					<span class="fn">Ryan Schoen</span>, <span class="org">Google</span>, &lt;<a class="email" href="mailto:rschoen@chromium.org">rschoen@chromium.org</a>&gt;
				</dd>
			</dl>

			<p class="copyright">
				<a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &copy; 2014 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&copy;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. <abbr title="World Wide Web Consortium">W3C</abbr><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
			</p>

			<hr>

			<h2 id="abstract">Abstract</h2>

			<p>
				This specification describes a method for animating content across web pages during a navigation, enabling seamless transitions between pages.
			</p>

			<h2 id="status">Status of This Document</h2>

			<p>
				<em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at http://www.w3.org/TR/.</em>
			</p>

			<p>
				This document is currently a draft, and has not been reviewed by any standards body or working group. It is still under heavy development.
			</p>

		</div>

		<spec-toc></spec-toc>

		<spec-clause id="introduction">
			<h1>Introduction</h1>

			<spec-section id="about">
				<h1>About this Document</h1>

				<p>
					All diagrams, examples, notes, are non-normative, as well as sections explicitly marked as non-normative. Everything else in this specification is normative.
				</p>

				<p>
					The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this document are to be interpreted as described in <a href="http://dev.w3.org/2006/xbl2/#refsRFC2119">RFC2119</a>. For readability, these words do not appear in all uppercase letters in this specification.
				</p>

				<p>
					Any point, at which a conforming UA must make decisions about the state or reaction to the state of the conceptual model, is captured as <a href="http://en.wikipedia.org/wiki/Algorithm">algorithm</a>. The algorithms are defined in terms of processing equivalence. The <dfn id="dfn-processing-equivalence">processing equivalence</dfn> is a constraint imposed on the algorithm implementers, requiring the output of the both UA-implemented and the specified algorithm to be exactly the same for all inputs.
				</p>
			</spec-section>

			<spec-section id="dependencies">
				<h1>Dependencies</h1>

				<p>
					This document relies on the following specifications:
				</p>

				<ul>
					<li>
						<a href="http://dom.spec.whatwg.org/">DOM Living Standard</a>
					</li>
					<li>
						<a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/">HTML Living Standard</a>
					</li>
					<li>
						<a href="http://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>
					</li>
					<li>
						<a href="http://url.spec.whatwg.org/">URL Living Standard</a>
					</li>
					<li>
						<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>
					</li>
					<li>
						<a href="http://www.w3.org/TR/mixed-content/">Mixed Content</a>
					</li>
					<li>
						<a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index">Service Workers</a>
					</li>
					<li>
						<a href="http://www.w3.org/TR/selectors4/">Selectors</a>
					</li>
					<li>
						<a href="http://www.w3.org/TR/CSP/">Content Security Policy</a>
					</li>
				</ul>
			</spec-section>

			<spec-section class="informative" id="motivations">
				<h1>Motivations</h1>

				<p>
					In traditional web browsers, the transition from one page to another is marked by a brief flash of white while the next page is loaded and displayed. For some browsers this is an indication of architecture (for example, a new render process being created) while for others it represents the lack of any other content to display.
				</p>

				<p>
					These hiccups in user experience can range from minor annoyances to major interruptions. The white flashes are a signature of the web, break the focus on the current task, and painfully highlight how much time is lost waiting. The sharp division between web pages also prevents developers from creatively filling the time, for example with a loading animation or cross-app transition.
				</p>

			</spec-section>
		</spec-clause>

		<spec-clause id="interface">
			<h1>Interface</h1>

			<spec-section class="informative" id="interface-for-referring">
				<h1>For the Referring Document</h1>
				<ol>
					<li>
						A new <a href="http://www.whatwg.org/specs/web-apps/current-work/#other-metadata-names">metadata name</a> which declares transition elements to be persisted during a navigation away from a document.
						<spec-code class="prettyprint">
&lt;meta name="transition-elements" content="<a href="http://www.w3.org/TR/2013/WD-selectors4-20130502/#selector-list">{CSS selector list}</a>; <a href="http://www.w3.org/TR/CSP/#source-list">{CSP source list}</a>"&gt;
						</spec-code>
					</li>
					<li>
						A new <a href="http://www.whatwg.org/specs/web-apps/current-work/#attr-link-rel">link rel type</a> which declares a stylesheet that the user agent may apply to animate a document just before it’s cleared due to a navigation. It is useful in its HTTP Response Header and HTML element form.
						<spec-code class="prettyprint">
Link: &lt;{URI}&gtl;; rel="transition-exiting-stylesheet"; scope="<a href="http://www.w3.org/TR/CSP/#source-list">{CSP source list}</a>";
&lt;link rel="transition-exiting-stylesheet" href="{URI}" scope="<a href="http://www.w3.org/TR/CSP/#source-list">{CSP source list}</a>"&gt;
						</spec-code>
					</li>
				</ol>
			</spec-section>

			<spec-section class="informative" id="interface-for-incoming">
				<h1>For the Incoming Document</h1>
				<p>
					A new <a href="http://www.whatwg.org/specs/web-apps/current-work/#attr-link-rel">link rel type</a> which declares a stylesheet that the user agent may apply to animate transition elements received from another document. It is most useful as an HTTP Response Header.
				</p>
				<spec-code class="prettyprint">
Link: &lt;{URI}&gt; rel="transition-entering-stylesheet"; scope="<a href="http://www.w3.org/TR/CSP/#source-list">{CSP source list}</a>";
				</spec-code>
			</spec-section>
		</spec-clause>
		
		<spec-clause id="process">
			<h1>Process</h1>
			<spec-section class="informative" id="amended-navigation-referring">
				<h1>Amended Navigation Steps for the Referring Document</h1>
				<p>Immediately upon receiving response headers for the incoming document:</p>
				<ol>
					<li>If transition-elements metadata is present and its <a href="http://www.w3.org/TR/CSP/#source-list">CSP source list</a> <a href="http://www.w3.org/TR/CSP/#matching">matches</a> the URI of the incoming document, then:
						<ol>
							<li>Create an ephemeral <a href="#transition-document-properties">transition document</a> rendered at a z-index above the referring document.</li>
							<li><a href="#move-element-operation">Move</a> all elements that match its <a href="http://www.w3.org/TR/2013/WD-selectors4-20130502/#selector-list">CSS selector list</a> to the transition document.</li>
						</ol>
					</li>
					<li>Perform <a href="#exit-transition">exit transition</a> steps.</li>
				</ol>
			</spec-section>
			<spec-section class="informative" id="amended-navigation-incoming">
				<h1>Amended Navigation Steps for the Incoming Document</h1>
				<ol>
					<li>Immediately upon receiving response headers for the incoming document (and recommended in parallel with the above steps):
						<ol>
							<li>Begin loading the incoming document rendered at a z-index below the referring document.</li>
							<li>If a transition-entering-stylesheet exists and its scope attribute is missing or <a href="http://www.w3.org/TR/CSP/#matching">matches</a> the URI of the referring document, then apply the sheet to the <a href="#transition-document-properties">transition document</a> (creating it if necessary).</li>
							<li>Block first rendering of the incoming document for at least <a href="#duration">NAVIGATION_TRANSITION_DURATION</a>.</li>
						</ol>
					</li>
					<li>Upon the incoming document’s DOMContentLoaded event, perform <a href="#exit-transition">exit transition</a> steps in the <a href="#transition-document-properties">transition document</a>.</li>
				</ol>
			</spec-section>
			<spec-section class="informative" id="exit-transition">
				<h1>Exit Transition</h1>
				<p>If a transition-exiting-stylesheet exists and its scope attribute is missing or <a href="http://www.w3.org/TR/CSP/#matching">matches</a> the URI of the loading document, then immediately after the window’s unload event:</p>
				<ol>
					<li>Kill all script contexts in the window.</li>
					<li>Apply the <a href="#ua-stylesheet">navigation transition user agent stylesheet</a>.</li>
					<li>Apply the transition-exiting-stylesheet.</li>
					<li>Queue a task to hide the document after <a href="#duration">NAVIGATION_TRANSITION_DURATION</a>.</li>
				</ol>
			</spec-section>
			<spec-section class="informative" id="transition-document-properties">
				<h1>Transition Document Properties</h1>
				<p>The transition document behaves like a fully <a href="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox">sandboxed</a> frame which has the <a href="#ua-stylesheet">navigation transition user agent stylesheet</a>.</p>
			</spec-section>
			<spec-section class="informative" id="move-element-operation">
				<h1>Move Element Operation</h1>
				<p>Transition element move operations behave somewhat like an <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.adoptNode">adoptNode</a> operation.</p>
				<p>The difference is that resolved styles are inlined into each element’s style and all script connections are stripped. Then, if the parent element is not already fixed position, its style is changed to position:fixed and its top, left, width and height coordinates are set to its current offsetTop, offsetLeft, offsetWidth, and offsetHeight respectively.</p>
				<p>Moves may not occur when in quirks mode or for documents without a viewport.</p>
			</spec-section>
			<spec-section class="informative" id="ua-stylesheet">
				<h1>Navigation Transition User Agent Stylesheet</h1>
				<p>Let the “navigation transition user agent stylesheet” be an additional user agent stylesheet which specifies default properties that apply to navigation transitions.</p>
				<spec-code class="prettyprint">
body {
  /* Permits document to specify that animation or transition duration should
   * inherit the user agent’s allowed navigation transition duration. */
  animation-duration: <a href="#duration">{NAVIGATION_TRANSITION_DURATION}</a>ms;
  transition-duration: <a href="#duration">{NAVIGATION_TRANSITION_DURATION}</a>ms;

  /* Allow any lower z-index documents to show through in transparent regions
   * as well as the ability to fade out the opacity of the document completely. */
  background: transparent;

  /* Prevent user interaction.
   * NOTE: !important prevents override by an author stylesheet. */
  pointer-events: none !important;
}
				</spec-code>
			</spec-section>
			<spec-section class="informative" id="duration">
				<h1>Transition Duration</h1>
				<p>Let NAVIGATION_TRANSITION_DURATION be any value that the user agent desires. It is recommended to be 300ms.</p>
			</spec-section>
		</spec-clause>

		<spec-clause id="security-considerations">
			<h1>Security Considerations</h1>

			<p class="fixme">
				The section will be added.
			</p>
		</spec-clause>

		<spec-clause id="performance-considerations">
			<h1>Performance Considerations</h1>

			<p>
				Network latency would be prohibitive for this design. However, <a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index">Service Workers</a> enable these animations to respond effectively immediately while concealing network delays associated with loading dynamic content.
			</p>

			<p>
				The recommended technique is for a page’s Service Worker to always immediately serve two things from its cache:
			</p>

			<ol>
				<li>
					HTTP Response headers for the root document including a Link header indicating the transition-entering-stylesheet.
				</li>
				<li>
					The transition-entering-stylesheet itself.
				</li>
			</ol>

			<p>
				Any updates to the above resources should be lazily updated by the Service Worker and used upon the next load.
			</p>

		</spec-clause>

		<spec-clause id="extensibility">
			<h1>Extensibility</h1>

			<p class="fixme">
				The section will be added.
			</p>
		</spec-clause>

		<spec-clause id="acknowledgements">
			<h1>Acknowledgements</h1>

			<p>
				Special thanks to those who contributed to this design, including: Adam Barth, Alex Komoroske, Alex Russell, Charlie Reis, George Mount, Greg Simon, Nat Duca, Shane Stephens, Tab Atkins, Timo Burkard and others.
			</p>

		</spec-clause>
	</body>
</html>
